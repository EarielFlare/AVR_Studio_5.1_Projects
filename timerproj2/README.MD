# Блок функций для работы с DS18B20

Здесь представлен очередной этап разработки. Добавлена возможность работы с датчиком температуры DS18B20 (одним на линии), а именно считывание температуры по интерфейсу 1-wire. Процесс считывания реализован через 16bit таймер, а точнее через флаговый автомат, размещенный в функции-обработчике прерывания таймера (т.е. работа с датчиком происходит псевдопараллельно основному циклу while()).

Последовательность чтения подразумевает отправку на датчик кодов (запросов), после чего мк осуществляет тактирование для приема данных с датчика. Подробнее про [датчик и коды](http://mypractic.ru/ds18b20-datchik-temperatury-s-interfejsom-1-wire-opisanie-na-russkom-yazyke.html). Последовательность кодов следующая:

1. Отправка сигнала сброса (reset), ожидание ответа (presence);
2. Отправка кода <пропуск ROM> (CCh/11001100);
3. Отправка кода <преобразование температуры> (44h/01000100);
4. Ожидание 1сек (время зависит от точности преобразования);
5. Отправка сигнала сброса (reset), ожидание ответа (presence);
6. Отправка кода <пропуск ROM> (CCh/11001100);
7. Отправка сигнала <чтение памяти> (BEh/10111110);
8. Прием 16 бит данных на мк (отправка тактирующего сигнала + считывание ответов).

По окончанию последовательности устанавливается флаг all_ready, по которому в основном цикле while() вызывается обработчик show_result. Полученные 16 бит данных преобразуются в число типа uint16_t, которое затем печатается в COM-порт при помощи функции disr_print.

Что нужно доработать (TODO LIST):
1. Полученное число отражает замеренную температуру, однако в зависимости от точности измерений его нужно домножить на константу (по умолчанию 0.0625). Поскольку функция disr_print способна работать только с int16_t, нужно добавить функцию для вывода числа типа fixed_value. Также в функцию show_result нужно добавить обработку отрицательных чисел (для измерения минусовых температур).
2. Сейчас программа работает с датчиком с настройками по умолчанию (максимальная точность измерения). Нужно добавить возможность изменения точности методом перезаписи регистра конфигурации датчика (запись в регистр и копирование в EEPROM).
2. Сейчас программа способна работать только с одним датчиком на линии. Для увеличения количества датчика нужно реализовать процедуру обращения к конкретному датчику по его адресу, а также процедуру идентификации датчиков на линии.
